<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/webService/frontend/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>페이지</title>
</head>
<body>
    <div class="container">
        <form id="mainForm" name="mainForm">
            <h1>Login</h1>
            <label for="username">Username</label>
            <input type="text" placeholder="Enter Username" name="username" required>

            <label for="password">Password</label>
            <input type="password" placeholder="Enter Password" name="password" required>

            <button type="button" onclick="getData()">Login</button>
            <button type="button" onclick="getForm()">Login2</button>
            <button type="button" onclick="getSpinner()">Login3</button>
        </form>
        <div id="loader" class="loader" style="display: none;">
            <i class="fa fa-spinner fa-spin" style="font-size: 50px;"></i>
        </div>
    </div>
    
    <script src="/frontend/script.js"></script>

    
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            const params = new URLSearchParams(window.location.search)
            
            params.forEach((value, key) => {
                const input = document.querySelector(`input[name=${key}]`);
                if (input) {
                    input.value = value;
                }
            });
        })

        async function getData(){
            updUrlString()
            try{
                const response = await fetch("http://localhost:3000/textUrl",{
                    method: 'POST',
                    headers:{
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(
                        {
                            name:"test",
                            name2:"test2"
                        }
                    ),
                    
                });

                const data = await response.json();
                console.log(data);
                return data;

            }catch(error){
                console.error(error);
            }
        }

        
        // url 인코딩 갱신
        function updUrlString(){
            const form =  document.getElementById('mainForm')
            const formData = new FormData(form)

            const params = new URLSearchParams()
            
            formData.forEach((val,key) => {
                params.append(key,val)
            })

            const newUrl = window.location.origin + window.location.pathname + '?' + params.toString()

            // URL을 변경하고 페이지를 새로고침하지 않음
            history.pushState(null, '', newUrl);
        }
    </script>
</body>
</html>